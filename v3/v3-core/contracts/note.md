
**UniswapV3Factory重点解释**:
- 工厂合约是整个 Uniswap V3 系统的入口点，负责创建和管理所有流动性池
- 初始化了三种默认费率：0.05%（500）、0.3%（3000）和1%（10000）
- 每种费率对应不同的 tick 间距，费率越高，tick 间距越大
- 池地址通过 token0、token1 和费率唯一确定，存储在双向映射中便于查询
- 只有工厂合约的所有者才能添加新的费率和设置新的所有者


**UniswapV3Pool重点解释**:

1. **状态变量**:
   - `Slot0`: 包含当前价格、当前tick、预言机观察数据等核心状态
   - `liquidity`: 当前活跃价格范围内的流动性总量
   - `positions`: 存储用户的流动性仓位信息
   - `ticks`: 存储每个激活的tick的信息
   - `observations`: 存储用于预言机的历史价格数据

2. **核心概念**:
   - 使用平方根价格表示 (`sqrtPriceX96`)，便于计算
   - 使用tick系统将价格空间离散化
   - 每个位置由所有者地址和price range (tickLower, tickUpper) 唯一确定
   - 包含完整的预言机实现，用于提供TWAP (时间加权平均价格)

3. **主要功能**:
   - `initialize`: 初始化池，设置初始价格
   - `mint`: 添加流动性到特定价格范围
   - `burn`: 从特定价格范围移除流动性
   - `swap`: 执行代币交换
   - `flash`: 提供闪电贷功能
   - `observe`: 获取历史价格数据，用于预言机

UniswapV3Pool 合约是 Uniswap V3 的核心组件，提供以下主要功能：

1. **流动性管理**：通过 mint/burn/collect 函数，允许用户在特定价格范围添加和移除流动性
2. **交易功能**：通过 swap 函数处理代币交换，使用高效的算法寻找最佳路径和计算价格影响
3. **预言机功能**：使用 observations 数组存储历史价格数据，通过 observe 函数提供 TWAP 数据
4. **闪电贷**：通过 flash 函数支持无抵押闪电贷
5. **费用管理**：跟踪和分配交易费用，包括流动性提供者和协议费用

合约设计非常注重燃气效率和安全性，使用了深度优化的数学库和数据结构。特别是预言机部分，通过高效的存储和计算方法，在不显著增加交易成本的情况下提供了强大的价格信息功能。
